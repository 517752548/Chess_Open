/* Copyright (c) 2012 MoPho' Games
 * All Rights Reserved
 * 
 * Please see the included 'LICENSE.TXT' for usage rights
 * If this asset was downloaded from the Unity Asset Store,
 * you may instead refer to the Unity Asset Store Customer EULA
 * If the asset was NOT purchased or downloaded from the Unity
 * Asset Store and no such 'LICENSE.TXT' is present, you may
 * assume that the software has been pirated.
 * */

using UnityEngine;

#if UNITY_EDITOR
using UnityEditor;
#endif

using System.Collections;
using Lemon.Extensions;

using MoPhoGames.USpeak.Interface;

[AddComponentMenu("USpeak/Default Talk Controller")]
public class MyDefaultTalkController : MonoBehaviour, IUSpeakTalkController
{
    [HideInInspector]
    [SerializeField]
    public KeyCode TriggerKey;

    [HideInInspector]
    [SerializeField]
    public int ToggleMode = 0; // PushToTalk

    private bool val = false;

    private void Start()
    {
        EventListener.Get(this.gameObject).onDown = OnSelfDown;
        EventListener.Get(this.gameObject).onUp = OnSelfUp;
    }

    void OnSelfDown(GameObject sender)
    {
        val = true;
        //string soundData = "B900000000001F8B08004C670F5900FF454E2B0E02410C7D0DAAC134C16C2D1A4182826CB807B7E008EB311D6E400206BB380C01834522E124B49D4D9834E9B4EFD3276A02552B6404280BBC7CA15CBCE72F6151582914831394116C5F650FBA30E0120B9F3A539014FF726BBF837CC9AA3DFC536308B73EF1D0E7E91402AD83868C84FEF2E84CE26A60CA836506E49A8B6A7C9301723FF77FB59B4670BFE13932DD36E7F97231791F57D7CF77B79ECE4E07ED6C3FFE0173266F2812010000C700000000001F8B08004C670F5900FF158BBD0E01411485CF1031377E32631A974A74AAD549964429D178A411B47257C366A340A75A3612A547E009C49BD83DCDF94EF29D2FCD144AA7B56A3E0FB1506BE81EE5365C12D4FA71924DCD69AFAF770064265EF2DE7018D6E05A3FEFB5284691F1DCBF7DD0A0455AA69CC1C818476E57B5D6630F64CE8426EE4569EAECBD3EDA2584E2CAAF5C6F0C354D2492CB66291D131975FB085EA444CE24D656F8A0F0C60A90480141681593A124CEC7164B1E743B167F1F4F1380C40000009200000000001F8B08004C670F5900FF4D8EB10DC2500C44CF2142B6688CA85CB0036CC16829ED0E948A0D905820236424EEE723810B4BF6DD3DFB3C285280F13E1B80C0AFD6093E2AB0ECA844C0AE433DE73F43CA6A53D571AFAA4C9EE4F568EB77567984A19C399344C1BF648E8409928DC8ED34CC4D368D42F3A577C1AAA45F5A6EAAE99703FA8B4C37767380BC0FE91131DEC40000007A00000000001F8B08004C670F5900FF258CB111C3300C03C1737217762CCD3A0B64006DE0A5340254FA3C46AA741A2DA08C8224C03FC0203526529B031823743308A3C18D80CDEFE3850AB0703799D02B18E915B5A3A38065A48F5D9AE9D5A26247E1F7CE9BD02B6415CEEDB4C967DF573303EFDFB9903F17BF79579C0000007700000000001F8B08004C670F5900FF3D8E310EC35008436D2543D99032F9D6FCB1EA6572B4984F544F809F91094BB883797E1089A280E0BE568E6B151281DE152B8B05F609B57A68BC53326C7B42F7F1A5E4D07E63B3D24B430E6823F2A3C5FDDE1861BC1B4C202365E6FA6124FDDBE0AD367A0028C9EF86C4000000AA00000000001F8B08004C670F5900FF558F310EC2400C0477050596404A94EA7E911E0ABEC16F22D152F84403E21344F701F859D60941898BBBB3773DAB23548E5C39935558955147695ECB16F8ECCCEAED03A8B058B0AC8181922F9DD79E29B5E5116F8B80D978F219E38C5CFEB6A527B51085EBFCF019CBF8DADF21708A81C696F9DF4D29006522E7EFC61414164EDF8BABED6D948B0741F6C3F576EEDCE9597AD33F83A01A007330C459120100006E00000000001F8B08004C670F5900FF1398C028C929C0000507983981E46610D360A3F0869913182632303248321CE84CE46A6E802A9A20203C517082F6C69906DC50919E9606846E900A0601C9098C0C0C2C3B39819A27083070324A4E10906FDC2576326A528FCA2E060025B71D63760000007E00000000001F8B08004C670F5900FF0BD9EBB8406B7383C26AC3D98C0C091B38364D64BCC0BC327283240B2F73C304C6091327323280C004464E868913052419183881A42448084C70324E60002A01B3214092931128CA2900E1416849064E20C908E67382544F60948499C02009B4846122034C0323442D502300739569A59C000000A300000000001F8B08004C670F5900FF2D8DB10D02310C45BF754D229A4857596207A03EC2026C43459905906C8986968E0EC802488CC030B47C9F70E3D8CE7B5F005881892AB28B62AE6E1064B1A259A0BC1A5C60EE8533DF28FCC43D30135B3B6D5288488DFEB8E05FE6A1A537300D8E06852A138963FDB9A6E858B5FB7B688C11EEE3302DB2F4790AC76BC836B9D4B44B3D658CFB653D7C9FC77A3BB7C4DC1FA953DA1CC4000000BA00000000001F8B08004C670F5900FF158E210B02411484E7B106D70B6EF461D02A28D8EF2E982D66FD332B2218674193E58C366111AB98ACFE03FF837FC077C384E10D7CF3FA0FACA7CD6B7F98F878695CB7EB013DDD80D51516EFE34D516DF9DDDDDC6CF97691001723707E0EAAC75EFA498C65CD50C701E5E93CB217CABC0005A6AC4412455D0E3B9AD26717C58B66353093F58A8A0CF0C1876A60D9E8087635AB2A7C0A341B4A590A538BA2B4352543733B615FFE016A4D62F9C4000000DC00000000001F8B08004C670F5900FF258F3D6E02410C859FB529D6DA66242ADF807228939995A873AA95A0A0B44503A283A448099303EC1148995BA48BD2C533B8F2DF7B9F1D3420AB66B4100813D8687142BCB2C4014A0AC305F83B97EDF4F3FBB694C3F5DDEC6CB7BD597F2BE43AA5AC2E9CCBD3386C1004EE5A4AEDB7A1DA380163467F44700893CFE10C887E753D3335FA987CF71E770435203CBFAC3E523AD57380EF2EDBEB8479E3420EEC08F7294A524B0DE2E130693899CB67D71C2B06E2DD98D2A0F043E85EA273F058C47A60CFEA9BEED940F80708C85C9B12010000DB00000000001F8B08004C670F5900FF01C4003BFF0D084080191900199001191990B4300B0000B5201B695FE9B6025C0AA19218098088290A18B004488BB3B35D1D88C383492A2AC1D295296B9BD5926A0CC4036B1BB1B3103B1AB0A5104D99B3835B09A1812AAAB394592B2AF3A2323FA9C3032E19A8A3A37B1A98B4834C2BD1A3102B88C6204A9BA58119A23B98F3213D98A281801B82AB07AA118009321C051B1CC610318C8218891A92B3892FBBD0839B7A88BB87880C839278118222331020F0C8BA9C9C321809FBFF2B9A9335488013100A21113300D03E7897C4000000B300000000001F8B08004C670F5900FF019C0063FF77778189A880AA89FF8B2999024610801281AA3081DD1010AD0824882043A8BB00CABC011D1817201A92A3AB9AFAAC800009203423433382B880F9BBA908283116031991DBAEBABB9B1B341531531083307091B2113C81013317989C9AE9BBBC08A9DBB9210DAB1623135353A843345188810980DBAB9A11FB8A9CC0B89FBAC9BFAB30533235342322331290B8BCCDBBAA894112FC9DFFA82169808175CD13079C000000DB00000000001F8B08004C670F5900FF01C4003BFFE7479BA14521F0A00A290314411290BADB8800FECF0910131108010480891823A3FABC09323332251392BDBC881283D9FF9F81312098A1112088084100B2CC8B383522232189BDBD883242FAFF0A180383081A021390888158A0F98928432403A0B99A0A90B0C1FFDFA121308091012082111A9C1288AAAB78723382A9AC9A108199F8FF1B0A0322289085211988C382019AAA8916362390C9CA09281191FFBFA13828911368289192202B49A8B9916A592203888C8D888101F8CF9AF2821008A2861100754F713CC40000006500000000001F8B08004C670F5900FF014E00B1FF77731948A1B9193E292513381CACA00828F9FF9BF28110089206101890A2811099A9D29241408093908B9BB8A3F4EF1CAB921259100412281A919293891D8AA315432081E1B8981B19F0FF1B0D00231093C64E0000004C01000000001F8B08004C670F5900FF1DCB394FC2500000602A438F84A40786D70E06AB44FA90846B51175007FE82BA48E2A2137172ECC3A51C26AF9D2A65A84C4A1361A48D43C78A26321313564756A7E7317FF9083913D678CD40D61397D093993AF01F47B92BB230F2ACA5DEF07A0BC8B23B31204CA644DE79F5995332C379C5929A3C42FC9FE103B89D1219E72D8A15C8BBFDFBB6FE0D6AEEDC9473022D667BC184BA2421DE6591D848EB560C68788E6558A425D07D89CC3AF1ED0D06A9E7690A0159C321CEC1235A00A3608A4FC8A70B652BD948A3A100A13BC7CA7E991681E34768B5F4BE5016C453424C7F4080F5A656B3B61637BB830091E74EC2A0AA3555A2E48E89BA776DFDF8B02086F74E6FB50C2246A1D62B25718814369CB6E1DE8E54BEED2F3C8E8C9D01E6ABB58C9A666D9DE97BF6E675B1546E05E3FEF74730E338AA725112A91FE6A9DE5638010000B300000000001F8B08004C670F5900FF019C0063FF775798890A08112421401280C9BCA9FEACACAB8918384535421181880998B9AA1A112423226310A1BDACEBDCCBBAAB89105245432312018888A9BBAB89314221221098CFCCCBBBDCBABB9C0920634443321312000090B9CB9BAAAB99AA8AB9DFDBBB9A89A0D9AA9A1A251653311422322032171108BCBCB9AB1911A8BCCC0008C8FBDBCB9A882123733324223232351390CDCBBA991822010800AAB0F864B30D9C000000DB00000000001F8B08004C670F5900FF01C4003BFFA7B0AABBBDBCAAAA193337346333241200ABCBAABB8998993292999BABB9BB391113DBAFCBA9091152341523110999B09A9E0C9B1A3843333399BBDB8013990DBEAABABB39362433102853334300B9FB9A9A9B0053034823123320B9F9A9B9ADA9A80B9A9A31453325322202BADBACAC0911221633229399BBEBB9198C898DABDB98307920224333232002BB8FAA80203233131019CBDB002199B0F988999990959930240304900000B307100080A20319BBAEBC392722A98F0CBF8D513513B9BD092100AB33664DC40000002501000000001F8B08004C670F5900FF0DCBB14EC2400000D06B59EE7029870CC8723D4AA29B7757DDCD31B82A1A777F411357EA447101266CEDE026D7FB00688D381202619745771362DCAC49F5EDEF26BBBBA4C324DA695486F3EE3133664F4679F21292C2BB3A39C3C0B7C0284124D0B5D34A09C26CF31CF94C722941A2918D81ED0C52BDCB5A853C0FA14DA994A5D1420D8387BD43C7E85878BCF499E867AB1859BC25B9399BC74A2970DEA45EA7DD4EA2AAAC9B59AE10A1C215E67AA1FC4E75FFBFFA108C53746523F2BD49B7985BE7BCFCB3509058B6ACF734A2ED7BD23427B58B8F558AA4C0B6B8FDD5DD1286965B784B88F4424B7A69F1DAC9A62191D8E0F4751957B9018E9CDE3260BC8F78E3711D9083AFA986C231081D7CA645B6ED813F50BB5FB6120100002901000000001F8B08004D670F5900FF011201EDFE7777B9AC18431380001190DCAB195224E1CEAB08333312323481CDAD89211201103300DEAA204412099991A0CB9B48442581DFBC8A204312223212D9BD9C183212012101D9AE8B313501800890B8BD99423522A0FFBC9A203433211202DBCD9A2843128100A8EABC0A444302988A9ACA9B1844342290FABFAC89423323120198BEBD093125118898ABCC9941352390BBABAAAB18652412A8B9E9CEBC195233138088A8CCAC09343581A8AACBCA19732401A9AA89AA9941352480A9AB89FCBE9B312711800880A8CB0B624381A9ABAACB0A744301A9AA99890A513413A8BBAB1053F9CF9B283423081010B0EC8A313581BABBBA9941552401AACB9A9920443382A9ABA91004FFAF8A222501880001BAAD29049368694112010000DB00000000001F8B08004D670F5900FF01C4003BFF7777BB9A8A8A42472290BBAB990931452288AA093125FAFF9B212401881801B8BD195413A0CB99889A38563390CBAA090820422381A99A31D4FF9E08331398091091CC9B632482CA9A88989A485522A8BB9B0021212203A0CA9A28A8FFAE891124201800A0DA99523511A9CBBAAB0A72422282A8BDAC0942140299898989893124B1CEBDAB8A20533423809B091203AA9F11229110563383DBACAB89009899191214DBBD183582EA9B293634899A2A4803A1293323BFBE9A52331488BACDACBB99093400135BC08FC4000000DB00000000001F8B08004D670F5900FF01C4003BFFAF93B95B25010831471391DACBAB0A332590DAAA8AB9EC9A623502B9AC89110118623502CA9C8B101130341483BABFCBAB80212011133500DCBB39472382A99A9910B1BC0D03B2CDAC803153443381BB9C0091F9C099890920542491BA9A042781A9BB3A38B1FB1A5312B9EC9A093152310290183333FBBDBB882831553482EAAB0A3143028108BBBEAC19321410DB99311110BA1027523213B9CFCA9A8A29543302BBCB8A28433513B0ECBA0A30170198ABBABB8A53542201124100B9BD9EBA99205300ED1D4CB9C4000000";
        //BattleRoomCtr.Instance.SendCommand.SendSoundMsgToServer(soundData);
    }

    void OnSelfUp(GameObject sender)
    {
        val = false;
    }


    #region IUSpeakTalkController Members

    public void OnInspectorGUI()
    {
#if UNITY_EDITOR
        TriggerKey = (KeyCode)EditorGUILayout.EnumPopup("Trigger Key", TriggerKey);
        ToggleMode = EditorGUILayout.Popup("Key Mode", ToggleMode, new string[] { "Push To Talk", "Toggle Talk" });
#endif
    }

    public bool ShouldSend()
    {
        //if( ToggleMode == 0 )
        //{
        //	val = Input.GetKey( TriggerKey );
        //}
        //else
        //{
        //	if( Input.GetKeyDown( TriggerKey ) )
        //		val = !val;
        //}
        return val;
    }

    #endregion
}